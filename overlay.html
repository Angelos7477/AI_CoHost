<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Overlay Panel</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: rgba(0, 0, 0, 0.0); /* Transparent for OBS */
      font-family: sans-serif;
      color: white;
    }

    #askai-overlay, #commentary-overlay, #event-overlay {
      /*display: none; /* âœ… Start hidden */
      position: absolute;
      padding: 12px 20px;
      font-size: 20px;
      background: rgba(20, 20, 20, 0.4);
      border-radius: 12px;
      max-width: 60%;
      white-space: pre-wrap;
      box-shadow: 0 0 20px rgba(20, 20, 20, 0.60);
    }

    #askai-overlay {
      bottom: 10%;
      left: 28%;
    }

    #commentary-overlay {
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
    }

    #event-overlay {
      top: 5%;
      left: 5%;
    }
  </style>
</head>
<body>

  <div id="askai-overlay">â“ Waiting for AskAI...</div>
  <div id="commentary-overlay">ğŸ™ï¸ Waiting for Commentary...</div>
  <div id="event-overlay">ğŸ‰ Waiting for Events...</div>

  <script>
    const askaiDiv = document.getElementById("askai-overlay");
    const commentaryDiv = document.getElementById("commentary-overlay");
    const eventDiv = document.getElementById("event-overlay");

    let ws = null;
    let reconnectTimeout = null;

    function connectWS() {
      console.log("[HTML] ğŸ”„ Connecting to WebSocket...");
      ws = new WebSocket("ws://127.0.0.1:8765");

      ws.onopen = () => {
        console.log("[HTML] âœ… WebSocket connected");
        if (reconnectTimeout) {
          clearTimeout(reconnectTimeout);
          reconnectTimeout = null;
        }
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        console.log("[HTML] ğŸ“© Message received:", data);

        if (data.type === "askai") {
          askaiDiv.textContent = `â“ ${data.question}\nğŸ’¬ ${data.answer}`;
          askaiDiv.style.display = "block"; // Show AskAI
        } else if (data.type === "commentary") {
          commentaryDiv.textContent = `ğŸ™ï¸ ${data.text}`;
          commentaryDiv.style.display = "block"; // Show Commentary
        } else if (data.type === "event") {
          eventDiv.textContent = `ğŸ‰ ${data.content}`;
          eventDiv.style.display = "block"; // Show Event
        } else if (data.type === "askai_hide") {
          askaiDiv.style.display = "none"; // Hide AskAI
        } else if (data.type === "commentary_hide") {
          commentaryDiv.style.display = "none"; // Hide Commentary
        } else if (data.type === "event_hide") {
          eventDiv.style.display = "none"; // Hide Event
        } else if (data.type === "mood") {
          // Optional: use this to change a header or apply a style
          console.log("ğŸ”„ Mood update:", data.text);
        } else {
          console.log("âš ï¸ Unknown message type:", data);
        }
      };

      ws.onerror = (e) => {
        console.log("[HTML] âŒ WebSocket error:", e);
        tryReconnect();
      };

      ws.onclose = () => {
        console.log("[HTML] âš ï¸ WebSocket connection closed");
        tryReconnect();
      };
    }

    function tryReconnect() {
      if (!reconnectTimeout) {
        reconnectTimeout = setTimeout(() => {
          reconnectTimeout = null;
          connectWS();
        }, 5000);
      }
    }

    connectWS();
  </script>
</body>
</html>
